# 文档合并工具（Swing + FlatLaf）

本项目是一个桌面应用，用于扫描指定目录下的 `.docx` / `.doc` 文件并按照列表顺序合并为一个输出 `.docx`。界面、提示与日志全部为简体中文（UTF-8）。

## 主要功能
- 选择输入目录与输出目录（记忆上次选择）。
- 支持从多个目录混合添加文件：
  - “添加文件...”支持多选 `.doc` / `.docx` 并按文件名自然排序后追加。
  - “添加目录...”扫描目录直接子文件并按目录内顺序追加。
  - “选择输入目录/刷新文件列表”作为批量加载快捷入口（按该目录历史顺序加载）。
- 默认排序：文件名前缀数字优先的自然排序；无数字则按不区分大小写的字典序，且排序稳定。
- 列表支持勾选合并（默认全选），提供“全选 / 全不选 / 反选”。
- 支持表格内拖拽调整顺序，顺序立即持久化；每个输入目录都有独立的顺序记录。
- 合并输出为一个 `.docx`，输出文件名可自定义：
  - 允许中文与空格；若未包含 `.docx` 自动补全。
  - 禁止 Windows 非法字符（\ / : * ? " < > |）。
  - 若输出文件已存在，合并前提示覆盖确认。
- 后台任务执行合并，进度提示、可取消。
- 实时中文日志面板，支持清空与复制全部。
- 配置持久化：`~/.doc-merge-app/config.json`，包含：
  - 上次输入/输出目录、输出文件名。
  - 合并列表顺序与勾选状态（含多目录混合）。
  - 每个目录的独立排序偏好（用于目录刷新）。

## 构建与运行（Windows PowerShell）
```powershell
mvn -q -DskipTests package
java -jar target\doc-merge-app-1.0.0.jar
```

## .doc 完美转换说明（硬性要求）
- `.doc -> .docx` 必须使用 COM 自动化引擎，优先级固定：
  1. Microsoft Word COM（ProgID：`Word.Application`）
  2. WPS 文字 COM（ProgID：`kwps.application`）
  3. 若两者都不可用：**硬性失败**（阻止合并，不生成任何输出文件）。
- 仅支持 Windows 环境，且需要本机已安装 Microsoft Word 或 WPS 文字。
- 程序会在启动时检测可用性（PowerShell + COM 探测），并在界面显示：
  - `Word 完美转换：可用/不可用`
  - `WPS 完美转换：可用/不可用`
  - `当前引擎：Microsoft Word / WPS 文字 / 无`
- 当不可用时：
  - 将阻止 `.doc` 文件加入列表；
  - 若列表中仍存在 `.doc`（例如历史配置残留），合并会被硬性阻止，不会生成任何输出文件。

### 可用性检测与故障排查
- PowerShell：优先使用 `pwsh`，无则回退到 `powershell`。
- 若提示不可用，请检查：
  1. 是否为 Windows 系统；
  2. 是否已安装 Microsoft Word 或 WPS 文字；
  3. PowerShell 执行策略是否允许脚本运行（建议临时使用 `-ExecutionPolicy Bypass`，程序内部已设置）。
- 若 Word/WPS 正在被其它实例占用或无响应，可能会导致转换失败，请先关闭可能卡住的 Word/WPS 实例后重试。
- 若出现“COM 探测失败/转换失败”，请优先查看日志中的 stderr 以定位具体原因。
- 路径包含空格或中文无需额外处理，程序会自动进行 PowerShell 转义。

## 使用提示
1. 点击“选择输入目录”，选择包含 `.docx` / `.doc` 的文件夹后可直接“刷新文件列表”。
2. 也可以使用“添加文件...”或“添加目录...”从多个位置混合加入待合并文件。
3. 在表格中拖拽行调整顺序；使用复选框决定是否参与合并。
4. 点击“选择输出目录”，填写或修改“输出文件名”。
5. 点击“开始合并”即可生成合并后的 `.docx`。
